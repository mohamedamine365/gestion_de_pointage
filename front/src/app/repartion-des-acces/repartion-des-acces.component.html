
<p-toast position="top-right" [showTransformOptions]="'translateY(100%)'" [showTransitionOptions]="'1000ms'"
[hideTransitionOptions]="'1000ms'" [showTransformOptions]="'translateX(100%)'" [style]="{ 
'position': 'fixed', 
'top': '251px', 
'right': '20px', 
'width': '400px', 
'height':'200px', 
'white-space': 'nowrap' 
}">
</p-toast>

<div class="custom-container mx-5 mt-4 mb-4">
  <!-- Section Statistiques Utilisateurs -->
  <div class="row mb-4 g-3">
    <div class="col-md-4">
      <div class="card stat-card bg-light-blue h-100">
        <div class="card-body text-center">
          <h5 class="card-title text-muted mb-3">Total Utilisateurs</h5>
          <div class="stat-value text-primary">
            {{loadingUserStats ? '...' : userStats.total}}
          </div>
          <div class="mt-2">
            <small class="text-success">{{userStats.active}} actifs</small> | 
            <small class="text-danger">{{userStats.inactive}} inactifs</small>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Carte Taux de Succès -->
    <div class="col-md-4">
      <div class="card stat-card bg-light-green h-100">
        <div class="card-body text-center">
          <h5 class="card-title text-muted mb-3">Taux de Succès Globale</h5>
          <div class="stat-value text-success">
            {{loadingMouvementStats ? '...' : mouvementStats.successRate}}%
          </div>
          <div class="mt-2">
            <small>{{mouvementStats.success}} succès / {{mouvementStats.failed}} échecs</small>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Carte Moyenne Journalière -->
    <div class="col-md-4">
      <div class="card stat-card bg-light-orange h-100">
        <div class="card-body text-center">
          <h5 class="card-title text-muted mb-3">Total mouvement</h5>
          <div class="stat-value text-warning">
            {{mouvementStats.total}}
          </div>
          <div class="mt-2">
            <small>Globale mouvement </small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Section Méthodes d'Authentification -->
  <div class="row mb-4 g-3">
    <div class="col-md-4">
      <div class="card stat-card bg-light-purple h-100">
        <div class="card-body text-center">
          <h5 class="card-title text-muted mb-3">Taux De Mouvement Par Badge Globale </h5>
          <div class="stat-value text-info">{{(mouvementStats.total > 0 ? (mouvementStats.badge / mouvementStats.total * 100) : 0).toFixed(1)}}%</div>
          <div class="mt-2">
            <small>Total : {{mouvementStats.badge}} badge</small>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card stat-card bg-light-teal h-100">
        <div class="card-body text-center">
          <h5 class="card-title text-muted mb-3">Taux de Mouvement Par Mobile Globale</h5>
          <div class="stat-value text-primary">{{(mouvementStats.total > 0 ? (mouvementStats.mobile / mouvementStats.total * 100) : 0).toFixed(1)}}%</div>
          <div class="mt-2">
            <small>Total : {{mouvementStats.mobile}} mobile</small>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card stat-card bg-light-pink h-100">
        <div class="card-body text-center">
          <h5 class="card-title text-muted mb-3">Mouvement Par Biométrique Globale</h5>
          <div class="stat-value text-danger">{{(mouvementStats.total > 0 ? (mouvementStats.biometrique / mouvementStats.total * 100) : 0).toFixed(1)}}%</div>
          <div class="mt-2">
            <small>Total : {{mouvementStats.biometrique}} Biométrique</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Section Graphique -->
  <div class="card mt-4">
    <div class="card-header bg-gradient-primary text-white">
      <h4 class="m-0"><i class="fas fa-chart-bar me-2"></i>Statistiques des accès (30 derniers jours)</h4>
    </div>
    <div class="card-body p-3">
      <div class="chart-wrapper">
        <div class="chart-container">
          <canvas baseChart
            [data]="barChartData"
            [options]="barChartOptions"
            [type]="ChartType">
          </canvas>
        </div>
      </div>
    </div>
  </div>
  <!-- Nouvelle section pour le pie chart des privilèges -->
<div class="row mt-4 g-2">
  <div class="col-md-6">
    <div class="card h-100">
      <div class="card-header bg-gradient-primary text-white">
        <h4 class="m-0 "><i class="fas fa-chart-pie me-2"></i>Répartition des privilèges</h4>
      </div>
      <div class="card-body">
        <div *ngIf="loadingPrivilegeStats" class="text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Chargement...</span>
          </div>
        </div>
        <div *ngIf="!loadingPrivilegeStats && privilegeStatsError" class="alert alert-danger">
          {{ privilegeStatsError }}
        </div>
        <div *ngIf="!loadingPrivilegeStats && !privilegeStatsError" class="chart-container-pie">
          <canvas baseChart
            [data]="pieChartData"
            [options]="pieChartOptions"
            [type]="pieChartType">
          </canvas>
        </div>
        <div *ngIf="!loadingPrivilegeStats && !privilegeStatsError" class="mt-3 text-center text-muted">
          <small>Total: {{ privilegeStats.total }} utilisateurs</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Nouvelle section pour le tableau des top utilisateurs -->
  <div class="col-lg-6">
    <div class="card h-100">
      <div class="card-header bg-gradient-primary text-white">
        <h4 class="m-0"><i class="fas fa-trophy me-2"></i>Top 4 des utilisateurs</h4>
      </div>
      <div class="card-body">
        <div *ngIf="loadingTopUsers" class="text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Chargement...</span>
          </div>
        </div>
        <div *ngIf="!loadingTopUsers && topUsersError" class="alert alert-danger">
          {{ topUsersError }}
        </div>
        <div *ngIf="!loadingTopUsers && !topUsersError" class="table-responsive">
          <table class="table table-hover table-striped">
            <thead class="table-light">
              <tr>
                <th scope="col">#</th>
                <th scope="col">Utilisateur</th>
                <th scope="col" class="text-end">Mouvements</th>
                <th scope="col" class="text-center">Performance</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of topUsers; let i = index" [ngClass]="{
                'table-primary': i === 0,
                'table-success': i === 1,
                'table-info': i === 2,
                'table-warning': i === 3
              }">
                <th scope="row">{{ i + 1 }}</th>
                <td>{{ user.nom }}</td>
                <td class="text-end">{{ user.mouvements }}</td>
                <td class="text-center">
                  <span *ngIf="i === 0" class="badge bg-gold">
                    <i class="fas fa-trophy"></i> 1er
                  </span>
                  <span *ngIf="i === 1" class="badge bg-silver">
                    <i class="fas fa-medal"></i> 2ème
                  </span>
                  <span *ngIf="i === 2" class="badge bg-bronze">
                    <i class="fas fa-medal"></i> 3ème
                  </span>
                  <span *ngIf="i === 3" class="badge bg-secondary">
                    4ème
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

